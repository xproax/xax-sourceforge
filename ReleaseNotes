Release Notes for FreeNAS 8.0.3-RELEASE-p1

*** IMPORTANT ***

- The image size increased in 8.0.1-BETA3.  The new size requires a 2 GB
  storage device.  The GUI upgrade can be used to upgrade a system from
  BETA3, BETA4, or RC1 but upgrades from earlier releases can only be
  done from the CD. The other option is to save the config, reinstall
  the new version, then restore the config.
- FreeBSD can be really touchy with hardware. Please be sure to update
  your BIOS/BMC firmware when upgrading / installing FreeNAS if you run
  into OS hang issues. There have been cases identified where a BIOS
  upgrade has fixed driver hangs, and/or other issues with FreeNAS; one
  such example was with an Intel 82578DC motherboard, as noted in the
  FreeNAS 8 forum thread titled "8.0.3-RELEASE coming soon..":
  http://bit.ly/rq78Q3 , post # 70-88. Again, please only do this if you
  experience booting / runtime issues, as some vendors don't test
  FreeBSD interoperability as much as others between major firmware
  releases.
- Previous builds were branded as i386/amd64 (32-bit and 64-bit
  respectively). 8.0.3-RC1+ rebranded the architectures as x86 and x64,
  respectively.

Changes since 8.0.3-RELEASE:

Enhancements
------------------------

OS/Third party
========================

1. Update ataidle from 2.6 to 2.72 based on maintainer's (brucec@FreeBSD)
   recommendation due to interoperabilities with 2.6 and certain chipsets.

Bugfixes
------------------------

Middleware
========================
1. Fix a regression for DHCP users where /etc/resolv.conf would be nulled
   out if DNS servers weren't specified in the GUI.

AD/CIFS
========================
1. Disable AIO by default and change the default AIO read / write size to
   2kB. This was done provided feedback and the fact that the build fixes
   actually enabled AIO, whereas prior releases didn't enable it by
   default. This can cause issues with machines that don't have the
   resources to service AIO requests quickly enough, where previously they
   would be able to service requests at near line speeds, whereas after
   they are unable to service requests that quickly.

Changes since 8.0.2-RELEASE:

Enhancements
------------------------

OS/Third party
========================

1. Use smaller block and frag sizes for /etc and /var .
2. Import a build tweak to nuke /var/db/pkg to save ~7MB space.
3. Other build tweaks to remove non-essential features and packages from
   the image.
4. Disable output to /var/log/console.log in non-debug builds to avoid
   unnecessary duplication in /var/log/messages .
5. Upgrade ataidle to 2.6.
6. Upgrade nut / net-snmp to 2.6.2 and 5.7.1, respectively.
7. Import omnibus build system fixes to fix the fact that the 8.0.3-BETA1
   image was broken due to the environment of the build machine where it
   was produced on. This also fixes other items, such as DDNS because of
   build environment tainting.
8. Increase the /var md size from 74MB to 160MB s.t. samba will be able
   to service requests copying large sets of files, and the rest of the
   system will be able to play nicely with samba to a certain degree.
   More tuning is required for larger samba userbases.

GUI
========================

1. Add kernel tunable / sysctl support.

Middleware
========================

1. Hide Etc/GMT* timezones as they're behavior is counterintuitive and
   conflicts with Windows 7 semantics (see r8707).

AD/CIFS
========================

1. Bump samba from 3.5.11 to 3.6.1.
2. Address simple failure cases with getting Kerberos tickets (clock
   skew) and joining AD domains (invalid passwords, bad short domain names,
   etc) so that users could better rectify improperly configured NAS boxes;
   this means that if either of these cases fail, the GUI will now inform
   the user that the 'Active Directory' service is stopped.
3. Fix cachetool to better prevent potential race condition at boot between
   winbindd and ix-cache.
4. Add knob for enabling/disabling Zeroconf/Bonjour (avahi) support in the
   GUI. For technical reasons outside of the author's control, this
   feature defaults to off when upgrading FreeNAS. FreeNAS admins
   anticipating that they will have Mac users attempting to connect to CIFS
   shares should enable this feature.

AFP
========================

1. Bump netatalk to 2.2.1.
2. Add knob for controlling the maximum number of configurable connections
   (see ticket: 847).
3. Only advertise services via avahi if they're enabled (see ticket: 852).

Rsync
========================

- NFSv4 ACL support (see: r8375, r8414).

Bugfixes
------------------------

OS/Third party
========================

1. Fix NTFS volume imports.

GUI
========================

1. ZFS volume deletion failed when trying to delete zvol with the name
   'zvol'.
2. SSH pubkey saving was broken unless you manually add a newline to the
   text box.
3. Fix traceback when trying to edit user if ssh public key was not
   specified.
4. Fix the bug in rsync tasks where it would strip the trailing '/' off
   the end of the destination path.
5. Fix a validation error when editing users / groups in 8.0.2+ where
   if one entered in a path that wasn't valid, the GUI would traceback
   instead of punting the actual validation error.
6. Fix an issue where if one entered in an invalid path, the GUI would
   traceback instead of providing feedback stating that the directory
   provided was invalid.

Middleware
========================

1. Rsync task/crontab generation was broken with AD usernames and other
   unsanitized input.
2. Fix email regressions since 8.0.2-RELEASE-p1 (SMART emails now work
   with more than one recipient, non-SMTP authentication based emails
   work again).
4. Fix an issue where if one autosnap process was killed uncleanly, more
   autosnap processes could back up and eventually deadlock the system.
5. Fix an issue where the ZFS scrub cronjobs would execute every 30 days
   instead of a number divisible by 7, so what would generally happen is
   that ZFS scrubs would generally execute in the middle of the week.
6. Fix setting httpd to listen on an interface which is not the first
   interface.
7. Add logic to create home directories on demand instead of failing
   'silently' if the path to the directory didn't already exist.
8. Fix 'detaching' NTFS/UFS volumes so that it unmounts the volume in
   the FreeBSD backend.

AD/CIFS
========================

1. Change the default workgroup from FREENAS to WORKGROUP as having the same
   name for the workgroup and the hostname is illegal per the SMB/CIFS
   protocol.

Cosmetic items
------------------------

1. Change "SSH key" in GUI to "SSH Public Key".
2. Fix GUI trademarks and branding to be more consistent with proper
   branding, similar to what TrueNAS does today.



Major changes since 8.0.1-RELEASE:

- The email subsystem was not working correctly in 8.0.1-RELEASE, which
  resulted in the system not being able to send mail, as well as of the
  alerting system in the GUI.

Changes since 8.0.1-RELEASE:

- Allow decimal numbers for a dataset quota. (r8728)

- Fix setting recursive ACLs. (r8270)

- Start proftpd after ix-ssl to use the correct SSL cert. (r8246)

- Use wildcards in cron and rsync jobs instead of listing all values. (r8214, r8211)

- Fix case in iSCSI targets to match the behavior specified by RFC 3722. (r8120)

Changes since 8.0-RELEASE:

There's too much to list here, but the high points are:

- Divorced the volume members in the database from the FreeBSD devices.
  This resolves an issue where FreeBSD can change devices names and the
  GUI doesn't pick up the updates due to the devices names being hard-wired
  in the database.

- Support exporting ZFS zvols (virtual devices) as device extents via iSCSI.
  8.0 was only able to export physical device nodes or file based extents.

- The GUI now has an event notification system.

- The email backend has been refactored.

- Many many changes in the GUI to help it validate and sanitize inputs that
  are passed to the backend daemons.

- Added UPS functionality.

- Added rsync client and server functionality.

- Added the ability to schedule cron jobs in the GUI.

- Vastly improved and reworked snapshot replication.

Errata:

- CHAP doesn't work with GlobalSAN initiators on OS X.

- Upgrades from FreeNAS 0.7 aren't supported.

- The installer doesn't check the size of the install media before attempting
  an install.  A 2 GB device is required, but the install will appear to
  complete successfully on smaller devices, only to fail at boot.

- The installer will let you switch from i386 to amd64 architecture and
  vice-versa, but some files, such as the rrd files used by the statistics
  graphing package are architecture dependent.

- There are known interoperability issues with FreeNAS and Samba 4.x being
  used as a PDC due to Samba 4.x not conforming to the Microsoft CIFS
  specification and the way LDAP queries are executed on FreeNAS. Please see
  the following support ticket for more details:
  http://support.freenas.org/ticket/1135 .

