{% extends "base.html" %}
{% block dojango_header_extra %}
<script type="text/javascript">
    function toggle_service(obj) {
        obj.src = '/services/toggle/' + obj.name + '/';
        }
</script>

<script type="text/javascript" src="/freenas/media/lib/js/test.json"></script>
<script type="text/javascript">
  dojo.addOnLoad(function() {
    var unitFilesystemId = null;
    var unitTypeId = null;
    var unitGroupId = null;
		new dijit.form.FilteringSelect({
			store: new dojo.data.ItemFileReadStore({
				data: filesystems
			}),
			autoComplete: true,
			style: "width: 150px;",
			required: false,
			id: "filesystem",
            onChange: function(filesystem) 
                {
                    unitFilesystemId = filesystem;
                    dijit.byId('type').query = {filesystemId: filesystem};
                }
            }, "filesystem");
        
		new dijit.form.FilteringSelect({
			store: new dojo.data.ItemFileReadStore({
				data: types
			}),
			autoComplete: true,
			style: "width: 150px;",
			required: false,
			id: "type",
             onChange: function(type) 
                {
                    unitTypeId = type;
                    dijit.byId('disk').query = {typeId: type};
                },
            }, "type");

        new dijit.form.FilteringSelect({
			store: new dojo.data.ItemFileReadStore({
				data: disks
			}),
			autoComplete: true,
			style: "width: 150px;",
			required: false,
			id: "disk",
            }, "disk");
      	});
</script>
{% endblock %} 
{% block content %}
<div dojoType="dijit.MenuBar" id="navMenu">

            <div dojoType="dijit.MenuBarItem" onClick="window.location='/'">
                <div>
                    System 
                </div>
            </div>

    <div dojoType="dijit.MenuBarItem" onClick="window.location='/network/'">
        <span>
            Network 
        </span>
    </div>

    <div dojoType="dijit.MenuBarItem" onClick="window.location='/storage/'" class=" dijitMenuItemSelected ">
        <span>
            Storage 
        </span>
    </div>

    <div dojoType="dijit.MenuBarItem" onClick="window.location='/sharing/'">
        <span>
            Sharing
        </span>
    </div>

    <div dojoType="dijit.MenuBarItem" onClick="window.location='/services/'">
        <span>
            Services
        </span>
    </div>


    {% if user.is_authenticated %}
    <div dojoType="dijit.MenuBarItem" onClick="window.location='/account/logout/'" style="position:relative;float:right;font-weight:bold;">
        <span>
            Log Out 
        </span>
    </div>
    <div dojoType="dijit.MenuBarItem" onClick="window.location='/account/password_change/'">
        <span>
            Account 
        </span>
    </div>
    {% else %}

    <div dojoType="dijit.MenuBarItem" onClick="window.location='/account/login/'" style="position:relative;float:right;font-weight:bold;">
        <span>
            Log In
        </span>
    </div>
    {% endif %}
</div>
{% endblock %}
{% block dojango_content %}
{% if user.is_authenticated %}
<div dojoType="dijit.layout.TabContainer" style="width:60%;float:left;padding-right:16px;" doLayout="false">
    <div dojoType="dijit.layout.ContentPane" title="Storage">
                  <table class="grid">
                <tbody>
                    <tr>
                        {% if disk_list %}
                        <h5>Active Disks: <strong>{{ disk_list|length }}</strong></h5>
                        {% else %}
                        There are no active disks.
                        {% endif %}
                    </tr>
                </tbody>
	            <thead class="ghead">
                    <td>Name</td>
	            <td>Description</td>
	            <td>Available actions</td>
	        </thead>
                <tbody>
                {% for d in disk_list %}
                <tr class="{% cycle 'odd' 'even' %}" id="{{ d.id }}">
                    <td>
                        {{ d.disk_name }}
                    </td>
                    <td>
                        {{ d.disk_description }}
                    </td>
                    <td>
                        <button dojoType="dijit.form.Button" type="button" onClick="window.location='/storage/disks/edit/{{ d.id }}/'">Edit</button>
                        <button dojoType="dijit.form.Button" type="button" onClick="window.location='/storage/volumes/delete/{{ d.disk_group.group_volume.id  }}/'">Delete Associated Volume</button>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="3">No disks defined</td>
                </tr>
                {% endfor %}
                </tbody>
                </table>
                <div style="padding:12px;"><button dojoType="dijit.form.Button" type="button" onClick="window.location='/storage/wizard/'">Storage Wizard</button>
                </div>
    </div>
</div>




<div dojoType="dijit.layout.TabContainer" style="width:300px;float:left;" doLayout="false">
    <div dojoType="dijit.layout.ContentPane" title="Shares">
                <h2>Configuration</h2>
        <table>
            <tr>
                <td><h4>NFS</h4></td>
                <td><h4>AFP</h4></td>
                <td><h4>CIFS</h4></td>
            </tr>
                <td>
                    <img class="srv" id="nfs_toggle" name="nfs_toggle" src="/freenas/media/images/ui/{% for s  in srv %}{% if s.srv_service == "nfs" %}{% if s.srv_enable %}on{% else %}off{% endif %}{% endif %}{% endfor %}.png" onClick="toggle_service(this)">
                </td>
                <td>
                    <img class="srv" id="afp_toggle" name="afp_toggle" src="/freenas/media/images/ui/{% for s  in srv %}{% if s.srv_service == "afp" %}{% if s.srv_enable %}on{% else %}off{% endif %}{% endif %}{% endfor %}.png" onClick="toggle_service(this)">
                </td>
                <td>
                    <img class="srv" id="cifs_toggle" name="cifs_toggle" src="/freenas/media/images/ui/{% for s  in srv %}{% if s.srv_service == "cifs" %}{% if s.srv_enable %}on{% else %}off{% endif %}{% endif %}{% endfor %}.png" onClick="toggle_service(this)">
                </td>
            </tr>
            <tr>
                <td>
                    <button id="nfs_settings" dojoType="dijit.form.Button" type="button">
                        Settings
                    <script type="dojo/method" event="onClick" args="evt">
                        dijit.byId("nfs").show();
                    </script>
                    </button>
                </td>
                <td>
                    <button id="afp_settings" dojoType="dijit.form.Button" type="button">
                        Settings
                    <script type="dojo/method" event="onClick" args="evt">
                        dijit.byId("afp").show();
                    </script>
                    </button>
                </td>
                <td>
                    <button id="cifs_settings" dojoType="dijit.form.Button" type="button">
                        Settings
                    <script type="dojo/method" event="onClick" args="evt">
                        dijit.byId("cifs").show();
                    </script>
                    </button>
                </td>
            </tr>
        </table>
    </div>
</div>

</div>
<div id="cifs" dojoType="dijit.Dialog" title="Windows - CIFS/SAMBA Shares">
<form action="/storage/" method="post">{% csrf_token %}
                    <table>
                        {{ cifs.errors }}
                        {{ cifs }}
                                   </table>
<button dojoType="dijit.form.Button" type="submit">Save Configuration</button>
<button dojoType="dijit.form.Button" type="button" onClick="dijit.byId('cifs').hide();">
    Cancel
</button>

</form>
    </div>
<div id="afp" dojoType="dijit.Dialog" title="Apple - AFP Shares">
<form action="/storage/" method="post">{% csrf_token %}
            <table>
                {{ afp.errors }}
                {{ afp }}
            </table>
<button  dojoType="dijit.form.Button" type="submit">Save Configuration</button>
<button dojoType="dijit.form.Button" type="button" onClick="dijit.byId('afp').hide();">
    Cancel
</button>
</form>
        </div>
          
<div id="nfs" dojoType="dijit.Dialog" title="UNIX - NFS Shares">
<form action="/storage/" method="post">{% csrf_token %}
     <table>
         {{ nfs.errors }}
         {{ nfs }}
                     </table>
<button  dojoType="dijit.form.Button" type="submit">Save Configuration</button>
<button dojoType="dijit.form.Button" type="button" onClick="dijit.byId('nfs').hide();">
    Cancel
</button>
</form>
        </div>

{% else %}
    <p>Welcome. Please <a href="/freenas/login/">log in</a>.</p>
{% endif %}

{% endblock %}

