{% extends "base.html" %}

{% block dojango_header_extra %}
<link rel="stylesheet" href="/dojango/dojo-media/release/freenas-dojo-1.5.0/dojox/grid/resources/claroGrid.css" type="text/css" /> 
<script type="text/javascript">

    dojo.require("dojo.data.ItemFileReadStore");
    dojo.require("dojo.data.ItemFileWriteStore");
    dojo.require("dojo.parser");
    dojo.require("dojo.dnd.Moveable");
    dojo.require("dijit.layout.BorderContainer");
    dojo.require("dijit.layout.AccordionContainer");
    dojo.require("dijit.layout.TabContainer");
    dojo.require("dijit.layout.ContentPane");
    dojo.require("dijit.Tree");
    dojo.require("dijit.tree.dndSource");
    dojo.require("dojox.grid.DataGrid");
    dojo.require("dojox.data.JsonRestStore");

    dojo.addOnLoad(function() {
         dojo.parser.parse(document.body);
     });

    function itemAccept(node, source, position){
                    var item = dijit.getEnclosingWidget(node).item;
                    if (item && item.children){
                            return true;
                    }
                    return false;
    }
</script>
{% endblock %}

{% block dojango_content %}

<div style="width:200px;float:left;">
    <div dojoType="dojo.data.ItemFileWriteStore" jsId="continentStore" url="/system/test/menu.json">
    </div>
    <div dojoType="dijit.tree.ForestStoreModel" jsId="continentModel" store="continentStore"
        query="{type:'app'}" rootId="continentRoot" rootLabel="Continents"
        childrenAttrs="children" showRoot="false">
    </div>
    <div dojoType="dijit.Tree" id="mytree" model="continentModel" openOnClick="true" showRoot="false" dndController="dijit.tree.dndSource" checkItemAcceptance="itemAccept">
            <script type="dojo/method" event="onClick" args="item">
                var p = dijit.byId("content");
                
            if(item.type && item.type == 'object') {
                dialog = new dijit.Dialog({ 
                    id: 'add_dialog',
                    title: item.name, 
                    href: item.view, 
                    parseOnLoad: true,
                    closable: true, 
                    style: "width: 650px;min-height:400px;background-color:white;overflow:auto;",
                    onHide: function() { this.destroyRecursive() },
                });
                dialog.show();
            } else if(item.type && item.type == 'editobject') {
                dialog = new dijit.Dialog({ 
                    id: 'edit_dialog',
                    title: item.name, 
                    href: item.view, 
                    parseOnLoad: true,
                    closable: true, 
                    style: "width: 650px;min-height:400px;background-color:white;overflow:auto;",
                    onHide: function() { this.destroyRecursive() },
                });
                dialog.show();
            } else if(item.type && item.type == 'viewmodel') {
                //  get the children and make sure we haven't opened this yet.
                var c = p.getChildren();
                for(var i=0; i<c.length; i++){
                    if(c[i].title == item.name){
                        p.selectChild(c[i]);
                        return;
                    }
                }
                var pane = new dijit.layout.ContentPane({ 
                    href: item.view, 
                    title: item.name, 
                    closable: true,
                    parseOnLoad: true,
                    //onLoad: dojo.hitch(pane, paneOnLoad)
                    //onLoad: function() { alert("aah"); }
                });
                p.addChild(pane);
                p.selectChild(pane);
            } else {
                //  get the children and make sure we haven't opened this yet.
                var c = p.getChildren();
                for(var i=0; i<c.length; i++){
                    if(c[i].title == item.name){
                        p.selectChild(c[i]);
                        return;
                    }
                }
                var pane = new dijit.layout.ContentPane({ 
                    href: item.view, 
                    title: item.name, 
                    closable: true,
                    parseOnLoad: true,
                    //onLoad: dojo.hitch(pane, paneOnLoad)
                    //onLoad: function() { alert("aah"); }
                });
                p.addChild(pane);
                p.selectChild(pane);
            }
    
            </script>
    </div>
</div>

<div id="mytab" style="float:left;width:700px;">
    <div dojoType="dijit.layout.TabContainer" style="width: 700px; height: 600px;"
        tabStrip="true" id="content">
    </div>
</div>

{% endblock %}
